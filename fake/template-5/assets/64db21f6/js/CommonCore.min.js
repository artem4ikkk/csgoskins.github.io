"use strict";var Comment=function(e){function t(e,t){$.ajax({url:r.addReloadUrl,method:"POST",data:{template:e,treeId:t},dataType:"json",success:function(e){if(e&&void 0!==e.items){var o=$(i+'[data-tree-id="'+t+'"]');o.first().closest(n).replaceWith('<div id="treeReload"></div>'),o.each(function(){$(this).closest(n).remove()}),$("#treeReload").replaceWith(e.items)}}})}var n=".comment-wrapper",i=".testimonials-item",o=$("#comment-list"),a={voteRequestFree:!0,addCommentRequestFree:!0},r=$.extend(!0,{validationUrl:null,loadMoreUrl:null,voteUrl:null,cid:0,treesLimit:null,addReloadUrl:null},e);$("body").on("beforeSubmit","form.comment-form",function(){if(!a.addCommentRequestFree)return!1;var e=$(this),r=e.closest(".add-testimonials").hasClass("reply");return $.ajax({url:e.attr("action"),method:"POST",data:e.serializeArray(),dataType:"json",beforeSend:function(){a.addCommentRequestFree=!1,e.find(".form-preloader").text("...")},success:function(s){if(s)if(r){var d=$("#load-more-comments").attr("data-t"),l=$(s).filter(n),c=l.find(i).data("tree-id");t(d,c)}else o.prepend($(s).filter(n));e.find(".form-preloader").text(""),e.find("textarea").val(""),e.find(".form-group").removeClass("has-success has-error"),e.find("button").blur(),a.addCommentRequestFree=!0},error:function(t,n,i){e.find(".form-preloader").text(""),a.addCommentRequestFree=!0}}),!1}).on("click","#load-more-comments",function(e){e.preventDefault();var t=$(this),n=t.attr("data-t"),i=parseInt(t.attr("data-tree-id"));$.post(r.loadMoreUrl,{template:n,treeId:i,_csrf:LandingCore.getCsrfToken()},function(e){if(void 0!==e.ids){var n=[];for(var i in e.ids)n.push(".comment-wrapper[data-id="+e.ids[i]+"]");n.length&&$(n.join(", ")).remove()}void 0!==e.items&&o.append(e.items),void 0!==e.treesCount&&"undefined"!=e.items&&e.items&&e.treesCount>=r.treesLimit?t.attr("data-tree-id",e.treeId):t.remove()},"json"),t.blur()}).on("click",".testimonials-list .reply-to",function(e){e.preventDefault(),$(".testimonials-list .add-testimonials.reply").each(function(){$(this).find(".cancel-reply").click()});var t=parseInt($(this).closest(i).attr("data-id")),o=$(".add-testimonials.main-comment-form").clone(!1),a=$(".main-comment-form .comment-form").yiiActiveForm("data"),s="comment-form-"+t,d=[];o.find("p.help-block.help-block-error").empty(),o.find("textarea").val(""),o.removeClass("main-comment-form"),o.addClass("reply"),o.find(".form-group").removeClass("has-success has-error"),o.find(".cancel-reply").removeClass("hidden"),o.find(".comment-form").attr("id",s),o.find(".comment-form").append($("<input>").attr({type:"hidden",name:"Comment[replyTo]",value:t}));for(var l in a.attributes){var c=a.attributes[l];d.push(c)}var m=$(this).closest(n).find(".reply-form");m.empty(),m.append(o),m.css("display","block"),$(this).closest(n).next(n).find(".comment").removeClass("first-reply"),$("#"+s).yiiActiveForm(d,{validationUrl:r.validationUrl})}).on("click",".reply-form .cancel-reply",function(e){e.preventDefault();var t=$(this).closest(n);t.find(i).attr("data-depth")<t.next(n).find(i).attr("data-depth")&&t.next(n).find(".comment").addClass("first-reply"),$(this).closest(".reply-form").css("display","none"),$(this).closest(".reply-form").html("")}).on("click",".rating-btn",function(e){function t(e,t){var n=e.closest(".rating");n.find(".rating-btn").removeClass("disabled"),0!==t&&n.find(".rating-btn[data-rating="+t+"]").addClass("disabled")}if(e.preventDefault(),!a.voteRequestFree)return!1;if($(this).hasClass("disabled"))return new PNotify({title:LandingCore.t("Ошибка"),text:LandingCore.t("Вы не можете голосовать дважды"),icon:"",type:"error",delay:8e3}),!1;var n=$(this);if(n.hasClass("disabled"))return!1;var o=$(this).closest(i).attr("data-id"),s=$(this).attr("data-rating"),d=$(this).closest(".rating").find(".total"),l=d.text();$.ajax({url:r.voteUrl,method:"POST",data:{commentId:o,rating:s},dataType:"json",beforeSend:function(){a.voteRequestFree=!1,d.text("...")},success:function(e){void 0!==e.totalRating?d.text(e.totalRating):d.text(l),void 0!==e.blockBtn&&t(n,e.blockBtn),a.voteRequestFree=!0},error:function(e,t,n){a.voteRequestFree=!0,d.text(l)}})})},LandingConfig=$.extend(!0,{domain:"",httpScheme:"",systemLanguage:"ru"},void 0!==LandingConfig?LandingConfig:{}),LandingCore=function(e){return{init:function(){this.initPNotify(),this.initTooltip()},initPNotify:function(){var e=$("#landings-flash-messages").find(".message");e.length&&e.each(function(e){var t=$(this);new PNotify({title:t.data("title"),text:t.text(),icon:t.data("icon"),type:t.data("style"),delay:8e3})})},initTooltip:function(){$("body").tooltip({selector:"[data-toggle=tooltip]",container:"body",placement:"top",trigger:"hover"})},getCsrfToken:function(){var e=$('meta[name="csrf-token"]').attr("content");return void 0!==e?e:null},preloader:{show:function(){$("#preloader").removeClass("hidden")},hide:function(){$("#preloader").addClass("hidden")}},delay:function(){var e=0;return function(t,n){clearTimeout(e),e=setTimeout(t,n)}},getSocketConnection:function(e,t){var n="//"+LandingConfig.domain+":3001";return t?io(n,t):io(n)},initVkGroup:function(e,t){$(window).load(function(){var n=$(t);if(!n.length||!e)return!1;var i=$('<div id="vk_groups"></div>'),o='<script type="text/javascript">VK.Widgets.Group("vk_groups", {mode: 3, width: "350"}, '+e+");<\/script>";$.getScript("//vk.com/js/api/openapi.js?144",function(){n.append(i),n.append(o)})})},plural:function(e,t){return e=Math.abs(e),(e%=100)>4&&e<21?t[2]:(e%=10,0==e||e>4?t[2]:1==e?t[0]:t[1])},t:function(e,t,n){n=n||LandingConfig.systemLanguage,t=t||{};var i="";if("ru"!=n&&(void 0!==LandingTranslations[n][e]?i=LandingTranslations[n][e]:$.get("/js-msg/log",{msg:e})),i||(i=e),t)for(var o in t)i=i.replace(new RegExp("{"+o+"}","g"),t[o]);return i},blockUI:function(){return{getObject:function(e){return"string"==typeof e?$(e):e},block:function(e,t){t=$.extend(!0,{message:'<i class="fa fa-spinner fa-2x fa-pulse"></i>',overlayCSS:{backgroundColor:"#fff",opacity:.8,cursor:"wait","box-shadow":"0 0 0 1px #ddd"},css:{border:0,padding:0,backgroundColor:"none"}},t||{}),this.getObject(e).block(t)},unblock:function(e){this.getObject(e).unblock()}}},emailValidationSuggests:function(){$(".email-validation-check").on("click",function(e){e.preventDefault();var t=$(this).data("validate-email"),n=$(this).data("email"),i=$(this).closest(".form-group").find("input[type=text], input[type=email]"),o=$(this).closest("form");1==t&&i.val(n),o.find("#hidden-validate-email").val(t),o.submit()})}}}();$(function(){LandingCore.init()});var LandingKey=function(e){function t(){a.run&&$.ajax({url:i.statusUrl,dataType:"json",contentType:"application/x-www-form-urlencoded",method:"POST",data:{_csrf:LandingCore.getCsrfToken()},success:function(e){""==e.openingState&&(a.run=!1),$(o.openingState).text(e.openingState),$(o.progressBar).css("width",e.openingPercent+"%"),$(o.openedBlock).html(""),e.opened.forEach(function(e){$(o.openedBlock).append("<p>"+e.current_key_state+"</p>")})}})}function n(e){void 0!==e&&$(".eTimer-free").eTimer({etType:0,etDate:e,etTitleText:"",etTitleSize:10,etShowSign:1,etSep:":",etFontFamily:"",etTextColor:"#a3a3a3",etPaddingTB:0,etPaddingLR:0,etBackground:"transparent",etBorderSize:0,etBorderRadius:0,etBorderColor:"white",etShadow:" 0px 0px 0px 0px #333333",etLastUnit:4,etNumberFontFamily:"Impact",etNumberSize:57,etNumberColor:"black",etNumberPaddingTB:7,etNumberPaddingLR:15,etNumberBackground:"white",etNumberBorderSize:0,etNumberBorderRadius:3,etNumberBorderColor:"white",etNumberShadow:"inset 0px 0px 10px 0px rgba(0, 0, 0, 0.5)"})}var i=$.extend(!0,{openingSymbolTime:"",nextSymbolInterval:"",statusUrl:null},e),o={openingState:"#opening",openedBlock:"#opened",progressBar:"#percent div"},a={run:!0};n(i.nextSymbolInterval),setTimeout(function(){t(),n(i.openingSymbolTime),setInterval(function(){t(),a.run&&n(i.openingSymbolTime)},1e3*i.openingSymbolTime)},1e3*i.nextSymbolInterval)};